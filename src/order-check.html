<!DOCTYPE html>
<html lang="ru" class="page">

@include('partials/head.html', {title: 'Проверка заказа'})

<body class="page-body">
  <div class="site-container">
    @include('partials/header.html', {
      page: 'profile'
    })

    <main class="main">
      <div class="main-sections">
        <section class="section">
          <div class="container">
            <div class="page-header">
              <nav class="breadcrumb">
                <ul class="list-reset breadcrumb-list">
                  <li class="breadcrumb-item">
                    <a href="/" class="btn btn-inherit breadcrumb-link">
                      оплата
                    </a>
                  </li>
                  <li class="breadcrumb-item">
                    <a href="/" class="btn btn-inherit breadcrumb-link">
                      способ получения
                    </a>
                  </li>
                  <li class="breadcrumb-item">
                    <p>
                      проверка заказа
                    </p>
                  </li>
                </ul>
              </nav>

              <h1 class="page-header-title">
                Проверка заказа
              </h1>
            </div>

            <div class="content-cols">
              <div class="content-col">
                <div class="content">
                  <h2>
                    корзина
                  </h2>
                </div>
              </div>
              <div class="content-col">
                <div class="order-container">
                  <div class="order-block">
                    <div class="order-block-content">
                      <ul class="list-reset list-card">
                        <li>
                          <article class="card card--order">
                            <div class="card-header">
                              <picture>
                                <source srcset="./img/card/image-1.webp" type="image/webp">
                                <img loading="lazy" src="./img/card/image-1.jpg" class="image" width="90" height="90"
                                  alt="Картинка">
                              </picture>
                            </div>
                            <div class="card-body">
                              <div class="card-content">
                                <h3 class="card-title">
                                  Анальный лубрикант Bunnylove
                                </h3>

                                <div class="card-stock product-stock">
                                  <span class="product-stock-name">
                                    В наличии:
                                  </span>
                                  <span class="product-stock-value">
                                    <a href="#" class="btn btn-inherit">Гагарина, 48</a>
                                    <a href="#" class="btn btn-inherit">Ново-Вокзальная 146а</a>
                                    <a href="#" class="btn btn-inherit">Ул. Московское шоссе, Лит.В</a>
                                    <a href="#" class="btn btn-inherit">Ул. Авроры 47А</a>
                                    <a href="#" class="btn btn-inherit">Ул. Авроры 47А</a>
                                  </span>
                                </div>
                              </div>

                              <div class="counter counter-sm">
                                <button type="button" class="btn btn-icon counter-button counter-decrement">
                                  <span class="icon">
                                    <svg>
                                      <use xlink:href="img/icons/minus.svg#svg-minus"></use>
                                    </svg>
                                  </span>
                                </button>
                                <div class="field-control counter-field-control">
                                  <input type="text" class="field counter-field" name="counter" placeholder="Кол-во"
                                    value="1">
                                </div>
                                <button type="button" class="btn btn-icon counter-button counter-increment">
                                  <span class="icon">
                                    <svg>
                                      <use xlink:href="img/icons/plus.svg#svg-plus"></use>
                                    </svg>
                                  </span>
                                </button>
                              </div>
                            </div>
                            <div class="card-footer">
                              <button type="button" class="btn btn-remove card-delete">
                                <span class="icon">
                                  <svg>
                                    <use xlink:href="img/icons/close.svg#svg-close"></use>
                                  </svg>
                                </span>
                              </button>

                              <div class="card-price product-price">
                                <div class="product-price-main">
                                  <span class="product-price-current">5&nbsp;571&nbsp;₽</span>
                                </div>
                              </div>
                            </div>
                          </article>
                        </li>
                        <li>
                          <article class="card card--order">
                            <div class="card-header">
                              <picture>
                                <source srcset="./img/card/image-1.webp" type="image/webp">
                                <img loading="lazy" src="./img/card/image-1.jpg" class="image" width="90" height="90"
                                  alt="Картинка">
                              </picture>
                            </div>
                            <div class="card-body">
                              <div class="card-content">
                                <h3 class="card-title">
                                  Анальный лубрикант Bunnylove
                                </h3>

                                <div class="card-stock product-stock">
                                  <span class="product-stock-name">
                                    В наличии:
                                  </span>
                                  <span class="product-stock-value">
                                    <a href="#" class="btn btn-inherit">Гагарина, 48</a>
                                    <a href="#" class="btn btn-inherit">Ново-Вокзальная 146а</a>
                                    <a href="#" class="btn btn-inherit">Ул. Московское шоссе, Лит.В</a>
                                    <a href="#" class="btn btn-inherit">Ул. Авроры 47А</a>
                                    <a href="#" class="btn btn-inherit">Ул. Авроры 47А</a>
                                  </span>
                                </div>
                              </div>

                              <div class="counter counter-sm">
                                <button type="button" class="btn btn-icon counter-button counter-decrement">
                                  <span class="icon">
                                    <svg>
                                      <use xlink:href="img/icons/minus.svg#svg-minus"></use>
                                    </svg>
                                  </span>
                                </button>
                                <div class="field-control counter-field-control">
                                  <input type="text" class="field counter-field" name="counter" placeholder="Кол-во"
                                    value="1">
                                </div>
                                <button type="button" class="btn btn-icon counter-button counter-increment">
                                  <span class="icon">
                                    <svg>
                                      <use xlink:href="img/icons/plus.svg#svg-plus"></use>
                                    </svg>
                                  </span>
                                </button>
                              </div>
                            </div>
                            <div class="card-footer">
                              <button type="button" class="btn btn-remove card-delete">
                                <span class="icon">
                                  <svg>
                                    <use xlink:href="img/icons/close.svg#svg-close"></use>
                                  </svg>
                                </span>
                              </button>

                              <div class="card-price product-price">
                                <div class="product-price-main">
                                  <span class="product-price-current">5&nbsp;571&nbsp;₽</span>
                                </div>
                              </div>
                            </div>
                          </article>
                        </li>
                        <li>
                          <article class="card card--order">
                            <div class="card-header">
                              <picture>
                                <source srcset="./img/card/image-1.webp" type="image/webp">
                                <img loading="lazy" src="./img/card/image-1.jpg" class="image" width="90" height="90"
                                  alt="Картинка">
                              </picture>
                            </div>
                            <div class="card-body">
                              <div class="card-content">
                                <h3 class="card-title">
                                  Анальный лубрикант Bunnylove
                                </h3>

                                <div class="card-stock product-stock">
                                  <span class="product-stock-name">
                                    В наличии:
                                  </span>
                                  <span class="product-stock-value">
                                    <a href="#" class="btn btn-inherit">Гагарина, 48</a>
                                    <a href="#" class="btn btn-inherit">Ново-Вокзальная 146а</a>
                                    <a href="#" class="btn btn-inherit">Ул. Московское шоссе, Лит.В</a>
                                    <a href="#" class="btn btn-inherit">Ул. Авроры 47А</a>
                                    <a href="#" class="btn btn-inherit">Ул. Авроры 47А</a>
                                  </span>
                                </div>
                              </div>

                              <div class="counter counter-sm">
                                <button type="button" class="btn btn-icon counter-button counter-decrement">
                                  <span class="icon">
                                    <svg>
                                      <use xlink:href="img/icons/minus.svg#svg-minus"></use>
                                    </svg>
                                  </span>
                                </button>
                                <div class="field-control counter-field-control">
                                  <input type="text" class="field counter-field" name="counter" placeholder="Кол-во"
                                    value="1">
                                </div>
                                <button type="button" class="btn btn-icon counter-button counter-increment">
                                  <span class="icon">
                                    <svg>
                                      <use xlink:href="img/icons/plus.svg#svg-plus"></use>
                                    </svg>
                                  </span>
                                </button>
                              </div>
                            </div>
                            <div class="card-footer">
                              <button type="button" class="btn btn-remove card-delete">
                                <span class="icon">
                                  <svg>
                                    <use xlink:href="img/icons/close.svg#svg-close"></use>
                                  </svg>
                                </span>
                              </button>

                              <div class="card-price product-price">
                                <div class="product-price-main">
                                  <span class="product-price-current">5&nbsp;571&nbsp;₽</span>
                                </div>
                              </div>
                            </div>
                          </article>
                        </li>
                      </ul>
                      <div class="alert alert--static">
                        <div class="alert-content">
                          <p>
                            Ваш заказ будет собираться из 2х магазинов, это может повлиять на время сборки заказа или <a
                              href="#" class="btn btn-inherit btn-inherit--underline">на стоимость доставки</a>.
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="order-block">
                    <h3 class="order-block-title">
                      Добавить к заказу
                    </h3>
                    <div class="order-block-content">
                      <ul class="list-reset list-card">
                        <li>
                          <article class="card card--add">
                            <div class="card-header">
                              <picture>
                                <source srcset="./img/card/image-1.webp" type="image/webp">
                                <img loading="lazy" src="./img/card/image-1.jpg" class="image" width="90" height="90"
                                  alt="Картинка">
                              </picture>
                            </div>
                            <div class="card-body">
                              <div class="card-content">
                                <h3 class="card-title">
                                  Коробка Bunnybox Mini
                                </h3>

                                <div class="card-descr">
                                  <p>
                                    Подарочная коробка белого цвета с надписью All you need is love, 20 х 20 х 10 см
                                  </p>
                                </div>
                              </div>

                              <div class="card-price product-price">
                                <div class="product-price-main">
                                  <span class="product-price-current">5&nbsp;571&nbsp;₽</span>
                                </div>
                              </div>
                            </div>
                            <div class="card-footer">
                              <button type="button" class="btn btn-base btn-outline-secondary card-add">
                                <span>добавить</span>
                                <span class="icon">
                                  <svg>
                                    <use xlink:href="img/icons/plus.svg#svg-plus"></use>
                                  </svg>
                                </span>
                              </button>
                            </div>
                          </article>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <div class="content-col">
                <div class="content">
                  <h2>
                    итого
                  </h2>
                </div>
              </div>
              <div class="content-col">
                <div class="content-form">
                  <div class="order-summary">
                    <div class="order-summary-header">
                      <h3 class="order-summary-total">
                        3 752 ₽
                      </h3>
                    </div>

                    <div class="order-summary-body">
                      <div class="order-summary-discount">
                        <dl class="product-characteristics" data-order="summary">
                          <dt>
                            2 товара на сумму
                          </dt>
                          <dd>
                            3 752 ₽
                          </dd>
                          <dt>
                            скидка
                          </dt>
                          <dd>
                            -1 ₽
                          </dd>
                        </dl>
                      </div>

                      <div class="order-summary-fields">
                        <form class="field-control">
                          <div class="field-wrapper field-wrapper--assent">
                            <input type="text" class="field" name="promocode" placeholder="ввести промокод"
                              data-input="promocode">
                            <button type="submit" class="btn field-button field-button--assent">
                              <span>
                                применить
                              </span>
                            </button>
                          </div>
                          <div class="field-feedback field-feedback--error">
                            <p>
                              такого промокода нет
                            </p>
                          </div>
                        </form>
                        <form class="field-control">
                          <div class="field-wrapper field-wrapper--assent">
                            <input type="text" class="field" name="promocode" placeholder="заплатить бонусами"
                              data-input="bonus">
                            <button type="submit" class="btn field-button field-button--assent">
                              <span>
                                применить
                              </span>
                            </button>
                          </div>
                          <div class="field-feedback field-feedback--error">
                            <p>
                              Максимальная сумма покрытия 30 ₽
                            </p>
                          </div>
                        </form>

                        <!-- (START) Demo Code -->
                        <script>
                          document.querySelectorAll('form.field-control')?.forEach((form) => {
                            const input = form.querySelector('[data-input]');
                            const wrapper = form.querySelector('.field-wrapper');
                            const summary = document.querySelectorAll('[data-order="summary"]');

                            if (!input || !wrapper || !summary) return;

                            form.addEventListener('submit', (e) => {
                              e.preventDefault();

                              const value = input.value.trim();
                              wrapper.classList.remove('is-invalid');

                              // имитация проверки на "успешность"
                              fakeRequest(value, input.dataset.input)
                                .then((discountText) => {
                                  // скрываем форму
                                  form.classList.add('visually-hidden');

                                  // добавляем блок в summary
                                  const dt = document.createElement('dt');
                                  const dd = document.createElement('dd');

                                  let labelText = '';
                                  let modalTarget = '';

                                  if (input.dataset.input === 'promocode') {
                                    labelText = 'промокод';
                                    modalTarget = '#modal-promocode-remove';
                                  } else if (input.dataset.input === 'bonus') {
                                    labelText = 'оплата бонусами';
                                    modalTarget = '#modal-bonus-remove';
                                  }

                                  dt.textContent = labelText;
                                  dd.innerHTML = `
                                    ${discountText}
                                    <button type="button" class="btn btn-remove dd-remove" aria-label="Close"
                                      data-bs-toggle="modal"
                                      data-bs-target=${modalTarget}>
                                      <span class="icon">
                                        <svg>
                                          <use xlink:href="img/icons/close.svg#svg-close"></use>
                                        </svg>
                                      </span>
                                    </button>
                                  `;

                                  summary.forEach(element => {
                                    element.appendChild(dt);
                                    element.appendChild(dd);
                                  })
                                })
                                .catch(() => {
                                  wrapper.classList.add('is-invalid');
                                });
                            });

                            input.addEventListener('input', () => {
                              wrapper.classList.remove('is-invalid');
                            });
                          });


                          // Фейковая проверка
                          function fakeRequest(value, type) {
                            return new Promise((resolve, reject) => {
                              setTimeout(() => {
                                if (!value) {
                                  reject();
                                  return;
                                }

                                if (type === 'promocode') {
                                  resolve('-300 ₽');
                                } else if (type === 'bonus') {
                                  resolve('-30 ₽');
                                } else {
                                  reject();
                                }
                              }, 300);
                            });
                          }
                        </script>
                        <!-- (END) Demo Code -->

                        <div class="order-info">
                          <div class="order-info-header">
                            <h4 class="order-info-title">
                              а еще у нас есть промокоды и бонусный счет
                            </h4>
                          </div>
                          <div class="order-info-body">
                            <div class="order-info-main">
                              <p>
                                с каждой покупки зарегистрированным пользователям мы будем зачислять % от суммы заказа
                                на бонусный счет для оплаты будущих покупок на сайте
                              </p>
                            </div>
                            <div class="order-info-footer">
                              <button type="button" class="btn btn-sm btn-secondary"
                                data-bs-toggle="offcanvas"
                                data-bs-target="#offcanvas-auth">
                                <span>войти / зарегистрироваться</span>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="order-summary-actions">
                        <button type="button" class="btn btn-lg btn-secondary">
                          <span>далее</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>

      @include('partials/floating-bottom.html')
      @include('partials/offcanvases.html')
      @include('partials/modals.html')
      <div class="alert-container"></div>
    </main>

    @include('partials/footer.html')
  </div>
</body>

</html>
